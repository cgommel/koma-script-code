% ======================================================================
% scrbookreportarticle-experts.tex
% Copyright (c) Markus Kohm, 2001-2012
%
% This file is part of the LaTeX2e KOMA-Script bundle.
%
% This work may be distributed and/or modified under the conditions of
% the LaTeX Project Public License, version 1.3c of the license.
% The latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3c or later is part of all distributions of LaTeX 
% version 2005/12/01 or later and of this work.
%
% This work has the LPPL maintenance status "author-maintained".
%
% The Current Maintainer and author of this work is Markus Kohm.
%
% This work consists of all files listed in manifest.txt.
% ----------------------------------------------------------------------
% scrbookreportarticle-experts.tex
% Copyright (c) Markus Kohm, 2001-2012
%
% Dieses Werk darf nach den Bedingungen der LaTeX Project Public Lizenz,
% Version 1.3c, verteilt und/oder veraendert werden.
% Die neuste Version dieser Lizenz ist
%   http://www.latex-project.org/lppl.txt
% und Version 1.3c ist Teil aller Verteilungen von LaTeX
% Version 2005/12/01 oder spaeter und dieses Werks.
%
% Dieses Werk hat den LPPL-Verwaltungs-Status "author-maintained"
% (allein durch den Autor verwaltet).
%
% Der Aktuelle Verwalter und Autor dieses Werkes ist Markus Kohm.
% 
% Dieses Werk besteht aus den in manifest.txt aufgefuehrten Dateien.
% ======================================================================
%
% Chapter about scrbook, scrreprt, and scrartcl of the KOMA-Script guide
% expert part
% Maintained by Markus Kohm
%
% ----------------------------------------------------------------------
%
% Kapitel ueber scrbook, scrreprt und scrartcl im Experten-Teil der
% KOMA-Script-Anleitung
% Verwaltet von Markus Kohm
%
% ============================================================================

\ProvidesFile{scrbookreportarticle-experts.tex}[2012/02/01 KOMA-Script guide (chapter: scrbook, scrreprt, scrartcl for experts)]

\chapter{Additional Information about the Main Classes 
  \Class{scrbook},  \Class{scrreprt}, and \Class{scrartcl} 
  as well as the Package \Package{scrextend}}
\labelbase{maincls-experts}

% TODO: Translation!
% Fake labels:

\textit{Sorry, this chapter is still missing in this translations. Translators
  from German to English would be welcome! Nevertheless some information
  about missing documentation at \autoref{cha:maincls} may be found here.}

Since version~3.00 the main classes understand command
\Macro{KOMAoptions} (see \autoref{sec:scrlttr2.options},
\autopageref{desc:scrlttr2.cmd.KOMAoptions}).  In the course of the
development many new options were implemented and old became obsolete.  Only
the new options may be used with \Macro{KOMAoptions}.  Unfortunately most of
them are documented not yet.  You may find the obsolete and corresponding new
options at \autoref{tab:maincls-experts.deprecated}.

Following options are still missing in \autoref{cha:maincls}:
\KOption{bibliography}\PName{setting}, \OptionValue{bibliography}{openstyle},
\OptionValue{bibliography}{oldstyle}, \OptionValue{captions}{bottombeside},
\OptionValue{captions}{centeredbeside}, \OptionValue{captions}{innerbeside},
\OptionValue{captions}{leftbeside}, \OptionValue{captions}{outerbeside},
\OptionValue{captions}{rightbeside}, \OptionValue{captins}{topbeside},
\KOption{fontsize}\PName{size}, \OptionValue{footnotes}{multiple},
\OptionValue{footnotes}{nomultiple}, \OptionValue{headings}{onelineappendix},
\OptionValue{headings}{twolineappendix}, \OptionValue{headings}{onelinechapter},
\OptionValue{headings}{twolinechapter}, \OptionValue{listof}{chapterentry},
\OptionValue{listof}{chaptergapline}, \OptionValue{listof}{chaptergapsmall},
\OptionValue{listof}{leveldown}, \OptionValue{listof}{nochaptergap},
\OptionValue{numbers}{autoendperiod}, \OptionValue{toc}{bibliography},
\OptionValue{toc}{bibliographynumbered}, \OptionValue{toc}{index},
\OptionValue{toc}{listof}, \OptionValue{toc}{listofnumbered},
\OptionValue{toc}{nobibliography}, \OptionValue{toc}{noindex},
\OptionValue{toc}{nolistof}, \KOption{version}\PName{value} (see
\autoref{sec:scrlttr2.compatibilityOptions},
\autopageref{desc:scrlttr2.option.version}).

\section{Obsolete Commands}
\label{sec:maincls-experts.obsolete}

\begin{Explain}
  In this section you will find commands which should not be used any
  longer. They are part of older {\KOMAScript} versions and their use
  was documented. For compatibility reasons they can still be used in
  the current {\KOMAScript} release. There are however new mechanisms
  and user interfaces which you should use instead. The reason for
  listing the obsolete macros in this documentation is only to aid
  users in understanding old documents.  Furthermore, package authors
  are free to use these macros in the future.

  \begin{Declaration}
    \Macro{sectfont}
  \end{Declaration}
  \BeginIndex{Cmd}{sectfont}%
  This macro sets the font which is used for all section headings and
  the abstract, the main title and the highest level below
  \Macro{part} in the table of contents. Instead, use the commands for
  the element \FontElement{disposition}, described in
  \autoref{sec:maincls.font}.%
  \EndIndex{Cmd}{sectfont}%

  \begin{Declaration}
    \Macro{capfont} \\
    \Macro{caplabelfont}
  \end{Declaration}
  \BeginIndex{Cmd}{capfont}%
  \BeginIndex{Cmd}{caplabelfont}%
  The macro \Macro{capfont} sets the font which is used for captions
  in tables and figures. The macro \Macro{caplabelfont} sets the font
  which is used for the label and numbering of tables and pictures.
  Instead, use the commands for the elements \FontElement{caption} and
  \FontElement{captionlabel}, described in
  \autoref{sec:maincls.font}.%
  \EndIndex{Cmd}{capfont}%
  \EndIndex{Cmd}{caplabelfont}%

  \begin{Declaration}
    \Macro{descfont}
  \end{Declaration}
  \BeginIndex{Cmd}{descfont}%
  This macro sets the font for the optional item arguments of a
  \Environment{description} environment. Instead, use the commands for
  the element \FontElement{descriptionlabel}, described in 
  \autoref{sec:maincls.font}.%
  \EndIndex{Cmd}{descfont}%

\end{Explain}

\begingroup
  \onelinecaptionsfalse
  \newcommand*{\NewOld}[2]{%
    \BeginIndex{Option}{#1}\PValue{#1} & \PValue{#2}\EndIndex{Option}{#1}\\
  }%
  \begin{longtable}{p{\dimexpr.5\textwidth-2\tabcolsep}p{\dimexpr.5\textwidth-2\tabcolsep}}
    \caption{Obsolete vs. Recommended Options\label{tab:maincls-experts.deprecated}}\\
    \toprule
    obsolete option & recommended option \\
    \midrule
    \endfirsthead
    \caption[]{Obsolete vs. Recommended Options
      (\emph{continuation})}\\
    \toprule
    obsolete Option & recommended option \\
    \midrule
    \endhead
    \midrule
    \multicolumn{2}{r@{}}{\dots}\\
    \endfoot
    \bottomrule
    \endlastfoot
    \NewOld{abstracton}{abstract}%
    \NewOld{abstractoff}{abstract=false}%
    \NewOld{parskip-}{parskip=full-}%
    \NewOld{parskip+}{parskip=full+}%
    \NewOld{parskip*}{parskip=full*}%
    \NewOld{halfparskip}{parskip=half}%
    \NewOld{halfparskip-}{parskip=half-}%
    \NewOld{halfparskip+}{parskip=half+}%
    \NewOld{halfparskip*}{parskip=half*}%
    \NewOld{tocleft}{toc=flat}%
    \NewOld{tocindent}{toc=graduated}%
    \NewOld{listsleft}{listof=flat}%
    \NewOld{listsindent}{listof=graduated}%
    \NewOld{cleardoubleempty}{cleardoublepage=empty}%
    \NewOld{cleardoubleplain}{cleardoublepage=plain}%
    \NewOld{cleardoublestandard}{cleardoublepage=current}%
    \NewOld{pointednumber}{numbers=enddot}%
    \NewOld{pointlessnumber}{numbers=noenddot}%
    \NewOld{nochapterprefix}{chapterprefix=false}%
    \NewOld{noappendixprefix}{appendixprefix=false}%
    \NewOld{bigheadings}{headings=big}%
    \NewOld{normalheadings}{headings=normal}%
    \NewOld{smallheadings}{headings=small}%
    \NewOld{headnosepline}{headsepline=false}%
    \NewOld{footnosepline}{footsepline=false}%
    \NewOld{liststotoc}{listof=totoc}%
    \NewOld{liststotocnumbered}{listof=numbered}%
    \NewOld{bibtotoc}{bibliography=totoc}%
    \NewOld{bibtotocnumbered}{bibliography=totocnumbered}%
    \NewOld{idxtotoc}{index=totoc}%
    \NewOld{tablecaptionabove}{captions=tableheading}%
    \NewOld{tablecaptionbelow}{captions=tablesignature}%
    \NewOld{onelinecaption}{captions=oneline}%
    \NewOld{noonelinecaption}{captions=nooneline}%
  \end{longtable}
\endgroup

\endinput

% ============================================================================
% Removed from scrbookreportarticle.tex:
% ============================================================================

\begin{Declaration}
  \OptionValue{toc}{graduated}\\
  \OptionValue{toc}{flat}
\end{Declaration}%
\BeginIndex{Option}{toc~=\PName{value}}%
\begin{Explain}
  In order to calculate automatically the space taken by the unit
  numbers when using the option \OptionValue{toc}{flat} it is necessary to
  redefine some macros. It is improbable but not impossible that this
  leads to problems when using other packages. If you think this may
  be causing problems, you should try the alternative option
  \OptionValue{toc}{graduated}, since it does not make any redefinitions. When
  using packages that affect the format of the table of contents, it
  is possible that the use of options \OptionValue{toc}{flat} and
  \OptionValue{toc}{graduated} too may lead to problems. When using such
  packages then, for safety's sake, one should refrain from using
  either of these options as global (class) options.

  If the \OptionValue{toc}{flat} option is active, the width of the field for
  unit numbering is determined when outputting the table of contents.
  After a change that affects the table of contents, at most three
  {\LaTeX} runs are necessary to obtain a correctly set table of
  contents.
\end{Explain}
\EndIndex{Option}{toc~=\PName{value}}%

\begin{Declaration}
  \Macro{tableofcontents}\\
  \Macro{contentsname}
\end{Declaration}%
\BeginIndex{Cmd}{tableofcontents}%
\BeginIndex{Cmd}{contentsname}%
\begin{Explain}
  The table of contents is set as an unnumbered chapter and is therefore
  subject to the side effects of the standard \Macro{chapter*} command,
  which are described in \autoref{sec:maincls.structure},
  \autopageref{desc:maincls.cmd.chapter*}.  However, the running
  headings\Index{running heading} for left and right pages are correctly filled
  with the heading of the table of contents. 

  The text of the heading is given by the macro
  \Macro{contentsname}. If you make use of a language package such as
  \Package{babel}, please read the documentation of that package
  before redefining this macro.
\end{Explain}%
\EndIndex{Cmd}{tableofcontents}%
\EndIndex{Cmd}{contentsname}%

There are two variants for the construction of the table of
contents. With the standard variant, the titles of the sectional units
are indented so that the unit number is flush left to the edge of the
text of the next upper sectional unit.  However, the space for the
numbers is thereby limited and is only sufficient for a little more
than 1.5 places per unit level.  Should this become a problem, the
option \OptionValue{toc}{flat} can be used to set the behaviour such that all
entries in the table of contents are set flush left under one
another. As explained in \autoref{sec:maincls.tocOptions},
\autopageref{desc:maincls.option.toc}, several {\LaTeX} runs are
needed.

{\KOMAScript} has always attempted to avoid page breaking directly
between a sectional unit and the adjacent next lower unit, for
example, between a chapter title and its first section title. However,
the mechanism worked poorly or not at all until version~2.96. In
version~2.96a\ChangedAt{v2.96a}{%
  \Class{scrbook} \and\Class{scrreprt} \and\Class{scrartcl}} the
mechanism was much improved and should now always work
correctly. There can be changes in the page breaking in the table of
contents as a result though. Thus, the new mechanism is only active,
if the compatibility option is not set to version~2.96 or less (see
option \Option{version}, \autoref{sec:maincls.compatibilityOptions},
\autopageref{desc:maincls.option.version}). The mechanism also does
not work if the commands to generate the table of contents are
redefined, for example, by the use of the package \Package{tocloft}.

\begin{Declaration}
  \Macro{ifthispageodd}\Parameter{true}\Parameter{false}
  \Macro{ifthispagewasodd} \PName{true}\Macro{else} \PName{false}\Macro{fi}
\end{Declaration}%
\BeginIndex{Cmd}{ifthispageodd}%
\BeginIndex{Cmd}{ifthispagewasodd}%
\begin{Explain}%
  A peculiarity of {\LaTeX} consists of the fact that it is not
  possible to determine on which page the current text will fall. It
  is also difficult to say whether the current page has an odd or an
  even page number. Now some will argue that there is, nevertheless,
  the {\TeX} test macro \Macro{ifodd} which one needs only to apply to
  the current page counter. However, this is an error. At the time of
  the evaluation of such a test {\LaTeX} does not know at all whether
  the text just processed will be typeset on the current page or only
  on the next. The page breaks take place not while reading the
  paragraph, but only in the \emph{output} routine of
  {\LaTeX}. However, at that moment a command of the form
  \verb|\ifodd\value{page}| would already have been completely
  evaluated.

  To find out reliably whether a text falls on an even or odd
  page, one must usually work with a label and a page reference to
  this label. One must also take special precautionary measures during
  the first {\LaTeX} run, when the label is not yet known.

  More precisely stated, the question is not where the text is, but
  whether a page reference to a label placed in this location would
  refer to an odd or an even page.

  There are situations where the \Macro{ifthispageodd} command never
  leads to the correct result. Suppose that the command is used within
  a box. A box is set by {\LaTeX} always as a whole. No page breaks
  take place inside. Assume further that the \PName{true} part is very
  big, but the \PName{false} part is empty. If we suppose further that
  the box with the \PName {false} part still fits on the current, even
  page, but that with the \PName{true} part it does not.  Further
  assume that {\KOMAScript} heuristically decides for the first run
  that the \PName{true} part applies. The decision is wrong and is
  revised in the next run. The \PName{false} part is thereby
  processed, instead of the \PName{true} part. The decision must again
  be revised in the next run and so on.

  These cases are rare. Nevertheless it should not be said that I have
  not pointed out that they are possible.

  Sometimes you need to know the state of the last decision. This may be done
  using the expert command \Macro{ifthispagewasodd}. This is either same like
  \Macro{iftrue} or \Macro{iffalse} and may be used like those.
\end{Explain}
%
\EndIndex{Cmd}{ifthispageodd}%
\EndIndex{Cmd}{ifthispagewasodd}%

\begin{Declaration}
  \Macro{chapterpagestyle}\\
  \Macro{markright}
\end{Declaration}
\BeginIndex{Cmd}{chapterpagestyle}%
\BeginIndex{Cmd}{markright}%
\begin{Explain}
  Whoever thinks that it is possible to put running headings on the
  first page of a chapter by using the command
\begin{lstcode}
  \renewcommand*{\chapterpagestyle}{headings}
\end{lstcode}
  will be surprised at the results.
  For sure, the page style \PValue{headings} is thereby applied to the
  initial page of a chapter. But nevertheless no running headings appear
  when using the \Option{openright} option.
  The reason for this behaviour can be found in the {\LaTeX}
  core. There, the command \Macro{rightmark}, that generates the marks
  for right-hand pages, is defined with;
\begin{lstcode}
  \let\@rightmark\@secondoftwo
  \def\rightmark{\expandafter\@rightmark
    \firstmark\@empty\@empty}
\end{lstcode}
  The right-hand mark is set with \Macro{firstmark}. \Macro{firstmark}
  contains the  left-hand  and right-hand  marks that were first set
  for a page. Within \Macro{chapter}, \Macro{markboth} is used to set
  the left mark to the chapter header and the right mark to empty.
  Hence, the first right
  mark on  a chapter beginning with a right-hand page is empty. Therefore,
  the running heading is also empty on those pages.

  You could redefine \Macro{rightmark} in the preamble so that the
  last mark on the page is used instead of the first:
\begin{lstcode}
  \makeatletter
  \renewcommand*{\rightmark}{%
    \expandafter\@rightmark\botmark\@empty\@empty}
  \makeatother
\end{lstcode}
  This would however cause the running heading of the first page of a
  chapter to use the title of the last section in the page. This is
  confusing and should be avoided.

  It is also confusing (and hence should be avoided) to have as
  running heading of the first page of a chapter the chapter title
  instead of the the section title. Therefore, the current behavior
  should be considered to be correct.
\end{Explain}
\EndIndex{Cmd}{markright}%
\EndIndex{Cmd}{chapterpagestyle}


\begin{Declaration}
  \Macro{the\PName{counter name}}
\end{Declaration}%
\BeginIndex{Cmd}{thecountername=the\PName{counter name}}%
As you might know, for every counter in {\LaTeX} there is a command
\Macro{the}\PName{countername}, which outputs the value of the
counter. Depending on the class the counter for a particular level
starting from \Macro{section} (\Class{book}, \Class{scrbook},
\Class{report}, \Class{scrreprt}) or \Macro{subsection}
(\Class{article}, \Class{scrartcl}) is composed of the counter for the
next higher level followed by a dot and the Arabic number of the
\PName{countername} of the respective level.\par
%
\EndIndex{Cmd}{thecountername=the\PName{counter name}}%

